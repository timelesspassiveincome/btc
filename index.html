<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PDF Slide Viewer</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
:root { --vh: 1vh; }

/* ===== Base ===== */
body {
  margin: 0;
  padding-top: 3.5rem;
  padding-bottom: 3.5rem;
  background: #f1f3f5;
  overflow: hidden;
  overscroll-behavior: none;
}

.pdf-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  background: #f8f9fa;
  padding: .25rem;
  border-radius: 12px;
  overflow: hidden;
}

#pdf-canvas {
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 12px 30px rgba(0,0,0,.15);
  touch-action: none;
  transform-origin: center center;
}

/* ===== Bottom Nav ===== */
.bottom-nav {
  position: fixed;
  bottom: .75rem;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255,255,255,.6);
  backdrop-filter: blur(8px);
  border-radius: 999px;
  padding: .3rem .6rem;
  box-shadow: 0 4px 12px rgba(0,0,0,.15);
  z-index: 1050;
}

.bottom-nav button {
  border: none;
  background: transparent;
  font-size: 1.2rem;
  opacity: .6;
}

#page-info {
  font-size: .85rem;
  opacity: .6;
}

/* ===== Fullscreen Button ===== */
.fullscreen-btn {
  position: fixed;
  right: .75rem;
  bottom: .75rem;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  background: rgba(0,0,0,.6);
  color: #fff;
  font-size: 1.25rem;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1100;
}

/* ===== Landscape Mobile ===== */
@media (orientation: landscape) and (max-width: 991px) {
  body {
    padding: 0;
    background: #000;
  }

  nav.navbar {
    display: none;
  }

  main.container {
    max-width: 100%;
    padding: 0;
    margin: 0;
  }

  .pdf-wrapper {
    height: calc(var(--vh) * 100);
    border-radius: 0;
    background: #000;
  }

  #pdf-canvas {
    border-radius: 0;
    box-shadow: none;
  }
}

/* ===== Force Nav Visible in Fullscreen ===== */
:fullscreen .bottom-nav {
  display: flex !important;
  bottom: 1rem;
  background: rgba(0,0,0,.55);
}

:fullscreen .bottom-nav button,
:fullscreen #page-info {
  color: #fff;
  opacity: .85;
}

/* === ADDED: Exit Fullscreen Button === */
.exit-fs-btn {
  position: fixed;
  top: .75rem;
  right: .75rem;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: none;
  background: rgba(0,0,0,.65);
  color: #fff;
  font-size: 1.1rem;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1200;
}
</style>
</head>

<body>

<nav class="navbar navbar-dark fixed-top bg-dark">
  <div class="container-fluid">
    <span class="navbar-brand">PDF Slides</span>
  </div>
</nav>

<main class="container mt-2">
  <div class="pdf-wrapper" id="viewer">
    <canvas id="pdf-canvas"></canvas>
  </div>
</main>

<div class="bottom-nav d-flex align-items-center gap-3">
  <button id="prev"><i class="bi bi-chevron-left"></i></button>
  <span id="page-info"></span>
  <button id="next"><i class="bi bi-chevron-right"></i></button>
</div>

<button class="fullscreen-btn" id="fsBtn">
  <i class="bi bi-arrows-fullscreen"></i>
</button>

<!-- === ADDED: Exit Fullscreen Button === -->
<button class="exit-fs-btn" id="exitFsBtn">
  <i class="bi bi-x-lg"></i>
</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<script>
/* ===== Fix VH ===== */
function setVH() {
  document.documentElement.style.setProperty(
    '--vh',
    `${window.visualViewport.height * 0.01}px`
  );
}
window.visualViewport.addEventListener('resize', setVH);
setVH();

/* ===== PDF Setup ===== */
const pdfUrl = 'file/bitcoin.pdf';
pdfjsLib.GlobalWorkerOptions.workerSrc =
  'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

let pdfDoc, pageNum = 1, zoomScale = 0.8, baseScale = 0.8;

const canvas = document.getElementById('pdf-canvas');
const ctx = canvas.getContext('2d');
const pageInfo = document.getElementById('page-info');
const viewer = document.getElementById('viewer');

/* ===== Render ===== */
function renderPage(num) {
  pdfDoc.getPage(num).then(page => {
    const unscaled = page.getViewport({ scale: 1 });
    baseScale = viewer.clientWidth / unscaled.width;

    const viewport = page.getViewport({
      scale: baseScale * zoomScale
    });

    canvas.width = viewport.width;
    canvas.height = viewport.height;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    page.render({ canvasContext: ctx, viewport });

    pageInfo.textContent = `${num} / ${pdfDoc.numPages}`;
  });
}

pdfjsLib.getDocument(pdfUrl).promise.then(pdf => {
  pdfDoc = pdf;
  renderPage(pageNum);
});

/* ===== Navigation Buttons ===== */
prev.onclick = () => {
  if (pageNum > 1) {
    zoomScale = 1;
    renderPage(--pageNum);
  }
};
next.onclick = () => {
  if (pageNum < pdfDoc.numPages) {
    zoomScale = 1;
    renderPage(++pageNum);
  }
};

/* ===== Pinch Zoom ===== */
let startDist = 0, tempScale = 1, isPinching = false;

const getDist = e => Math.hypot(
  e.touches[0].clientX - e.touches[1].clientX,
  e.touches[0].clientY - e.touches[1].clientY
);

canvas.addEventListener('touchstart', e => {
  if (e.touches.length === 2) {
    isPinching = true;
    startDist = getDist(e);
  }
});

canvas.addEventListener('touchmove', e => {
  if (e.touches.length === 2) {
    e.preventDefault();
    tempScale = zoomScale * (getDist(e) / startDist);
    tempScale = Math.min(Math.max(tempScale, 1), 3);
    canvas.style.transform = `scale(${tempScale})`;
  }
}, { passive: false });

canvas.addEventListener('touchend', () => {
  if (isPinching) {
    zoomScale = tempScale;
    canvas.style.transform = 'none';
    isPinching = false;
    renderPage(pageNum);
  }
});

/* ===== Swipe Change Page ===== */
let touchStartX = 0;
let touchEndX = 0;

canvas.addEventListener('touchstart', e => {
  if (e.touches.length === 1 && zoomScale === 1) {
    touchStartX = e.touches[0].clientX;
  }
});

canvas.addEventListener('touchend', e => {
  if (zoomScale !== 1) return;

  touchEndX = e.changedTouches[0].clientX;
  const deltaX = touchEndX - touchStartX;

  if (Math.abs(deltaX) > 80) {
    if (deltaX < 0 && pageNum < pdfDoc.numPages) {
      zoomScale = 1;
      renderPage(++pageNum);
    } else if (deltaX > 0 && pageNum > 1) {
      zoomScale = 1;
      renderPage(--pageNum);
    }
  }
});

/* ===== Fullscreen + Orientation ===== */
const fsBtn = document.getElementById('fsBtn');

fsBtn.onclick = async () => {
  if (!document.fullscreenElement) {
    await viewer.requestFullscreen();
    if (screen.orientation?.lock) {
      try { await screen.orientation.lock('landscape'); } catch {}
    }
  } else {
    document.exitFullscreen();
  }
};

document.addEventListener('fullscreenchange', () => {
  if (!document.fullscreenElement && screen.orientation?.unlock) {
    screen.orientation.unlock();
  }

  fsBtn.innerHTML = document.fullscreenElement
    ? '<i class="bi bi-fullscreen-exit"></i>'
    : '<i class="bi bi-arrows-fullscreen"></i>';

  setTimeout(() => renderPage(pageNum), 300);
});

/* === ADDED: Exit Fullscreen Logic === */
const exitFsBtn = document.getElementById('exitFsBtn');

exitFsBtn.onclick = () => document.exitFullscreen();

document.addEventListener('fullscreenchange', () => {
  exitFsBtn.style.display = document.fullscreenElement ? 'flex' : 'none';
});
</script>

</body>
</html>
